<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PARMCO Project - RPM Matcher Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fdfcfb; color: #292524; }
        .sticky-nav { position: sticky; top: 0; z-index: 50; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); background-color: rgba(253, 252, 251, 0.8); }
        
        /* Gauge Animation */
        .gauge-needle {
            transform-origin: bottom center;
            transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 28px;
            width: 28px;
            border-radius: 50%;
            background: #0369a1;
            cursor: pointer;
            margin-top: -12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 4px;
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen">

    <header class="sticky-nav border-b border-stone-200">
        <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <span class="text-xl font-bold text-sky-700">PARMCO Project</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-stone-600 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Overview</a>
                        <a href="hardware.html" class="text-stone-600 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Hardware</a>
                        <a href="server.html" class="text-stone-600 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Server</a>
                        <a href="app.html" class="text-stone-600 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">App</a>
                        <a href="controller.html" class="text-stone-600 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Controller</a>
                        <a href="documentation.html" class="text-stone-600 hover:text-sky-700 px-3 py-2 rounded-md text-sm font-medium">Documents</a>
                        <a href="game.html" class="text-sky-700 font-bold px-3 py-2 rounded-md text-sm">Mini-Game</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="flex-grow flex items-center justify-center py-12 px-4">
        <div class="bg-white p-8 rounded-2xl shadow-xl border border-stone-100 max-w-lg w-full text-center relative overflow-hidden">
            
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-stone-800 mb-2">RPM Matcher</h1>
                <p class="text-stone-500">Adjust the throttle to match the Target RPM before time runs out!</p>
            </div>

            <div class="flex justify-between mb-8 px-4">
                <div class="text-left">
                    <div class="text-xs uppercase tracking-wider text-stone-400 font-bold">Score</div>
                    <div id="scoreDisplay" class="text-2xl font-bold text-sky-700">0</div>
                </div>
                <div class="text-right">
                    <div class="text-xs uppercase tracking-wider text-stone-400 font-bold">Time</div>
                    <div id="timeDisplay" class="text-2xl font-bold text-red-500">30s</div>
                </div>
            </div>

            <div class="relative h-48 w-full flex justify-center mb-6">
                <svg viewBox="0 0 200 100" class="w-64 h-32 overflow-visible">
                    <path d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="#e5e7eb" stroke-width="20" stroke-linecap="round" />
                    
                    <path id="targetZone" d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="#bef264" stroke-width="20" stroke-dasharray="50, 450" stroke-dashoffset="0" stroke-linecap="butt" class="transition-all duration-300" />

                    <g id="needle" class="gauge-needle" style="transform: rotate(-90deg);">
                        <line x1="100" y1="100" x2="100" y2="20" stroke="#44403c" stroke-width="4" stroke-linecap="round" />
                        <circle cx="100" cy="100" r="6" fill="#44403c" />
                    </g>
                </svg>
                
                <div class="absolute bottom-0 left-0 right-0 text-center">
                    <div id="currentRpmDisplay" class="text-4xl font-bold text-stone-800">0</div>
                    <div class="text-xs font-bold text-stone-400 uppercase">Actual RPM</div>
                </div>
            </div>

            <div class="mb-8 bg-stone-50 rounded-lg py-2 border border-stone-200">
                <span class="text-stone-500 text-sm font-semibold">TARGET: </span>
                <span id="targetRpmDisplay" class="text-xl font-bold text-stone-800">---</span>
            </div>

            <div class="space-y-6">
                <div class="relative">
                    <input type="range" id="throttleSlider" min="0" max="5000" value="0" disabled>
                    <div class="flex justify-between text-xs text-stone-400 mt-2 font-medium">
                        <span>IDLE</span>
                        <span>MAX</span>
                    </div>
                </div>

                <button id="startBtn" class="w-full py-4 bg-sky-700 hover:bg-sky-800 text-white font-bold rounded-xl shadow-lg transform transition hover:-translate-y-0.5 active:translate-y-0">
                    START ENGINE
                </button>
            </div>

            <div id="gameOverScreen" class="hidden absolute inset-0 bg-white/95 flex-col items-center justify-center z-20">
                <h2 class="text-4xl font-bold text-stone-800 mb-2">Game Over!</h2>
                <p class="text-lg text-stone-600 mb-6">Final Score: <span id="finalScore" class="font-bold text-sky-700">0</span></p>
                <button onclick="resetGame()" class="px-8 py-3 bg-stone-800 text-white font-bold rounded-lg hover:bg-stone-900">Try Again</button>
            </div>

        </div>
    </main>

    <footer class="text-center py-8 border-t border-stone-200">
        <p class="text-stone-500">ECSE 4235 Final Project - Group 5</p>
    </footer>

    <script>
        // Game State
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let targetRPM = 0;
        let currentRPM = 0;
        let timerInterval;
        let checkInterval;

        // DOM Elements
        const needle = document.getElementById('needle');
        const slider = document.getElementById('throttleSlider');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentRpmDisplay = document.getElementById('currentRpmDisplay');
        const targetRpmDisplay = document.getElementById('targetRpmDisplay');
        const startBtn = document.getElementById('startBtn');
        const targetZone = document.getElementById('targetZone');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScore = document.getElementById('finalScore');

        // Audio Context for Engine Sound (Simple Oscillator)
        let audioCtx;
        let oscillator;
        let gainNode;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                oscillator = audioCtx.createOscillator();
                gainNode = audioCtx.createGain();
                
                oscillator.type = 'sawtooth';
                oscillator.frequency.value = 100; // Idle rumble
                gainNode.gain.value = 0.1; // Low volume
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start();
            }
        }

        function updateEngineSound(rpm) {
            if(audioCtx && gameActive) {
                // Map 0-5000 RPM to 60Hz - 400Hz pitch
                const pitch = 60 + (rpm / 5000) * 340;
                oscillator.frequency.setTargetAtTime(pitch, audioCtx.currentTime, 0.1);
            }
        }

        function stopAudio() {
            if (audioCtx) {
                oscillator.stop();
                audioCtx.close();
                audioCtx = null;
            }
        }

        function setNeedle(rpm) {
            // Map 0-5000 RPM to -90deg (left) to 90deg (right)
            const deg = -90 + (rpm / 5000) * 180;
            needle.style.transform = `rotate(${deg}deg)`;
            currentRpmDisplay.textContent = rpm;
        }

        function setTarget() {
            if (!gameActive) return;
            
            // Random target between 1000 and 4500
            targetRPM = Math.floor(Math.random() * 3500) + 1000;
            targetRpmDisplay.textContent = targetRPM;

            // Update visual target zone on the arch
            // Arch is 160 units long (pi * r). We map RPM to stroke-dashoffset.
            // This is a simplified approximation for the visual effect.
            const percent = targetRPM / 5000;
            // Rotate the "green zone" to match the target
            // Note: This simple SVG stroke-dash manipulation is purely visual/approximate for the game feel
        }

        function startGame() {
            initAudio();
            gameActive = true;
            score = 0;
            timeLeft = 30;
            scoreDisplay.textContent = '0';
            timeDisplay.textContent = '30s';
            startBtn.style.display = 'none';
            slider.disabled = false;
            slider.value = 0;
            
            setTarget();

            // Countdown Timer
            timerInterval = setInterval(() => {
                timeLeft--;
                timeDisplay.textContent = timeLeft + 's';
                if (timeLeft <= 0) endGame();
            }, 1000);

            // Check accuracy loop (runs 10 times a second)
            checkInterval = setInterval(() => {
                const val = parseInt(slider.value);
                updateEngineSound(val);
                setNeedle(val);

                // Check if within 200 RPM tolerance
                const diff = Math.abs(val - targetRPM);
                
                if (diff < 250) {
                    // Success!
                    score += 100;
                    scoreDisplay.textContent = score;
                    scoreDisplay.classList.add('text-green-600');
                    setTimeout(() => scoreDisplay.classList.remove('text-green-600'), 200);
                    
                    // New Target
                    setTarget();
                }
            }, 100);
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            clearInterval(checkInterval);
            stopAudio();
            
            slider.disabled = true;
            finalScore.textContent = score;
            gameOverScreen.classList.remove('hidden');
            gameOverScreen.classList.add('flex');
        }

        function resetGame() {
            gameOverScreen.classList.add('hidden');
            gameOverScreen.classList.remove('flex');
            startBtn.style.display = 'block';
            setNeedle(0);
            targetRpmDisplay.textContent = '---';
        }

        startBtn.addEventListener('click', startGame);
        
        // Smooth updates for dragging
        slider.addEventListener('input', (e) => {
            if(gameActive) {
                setNeedle(e.target.value);
                updateEngineSound(e.target.value);
            }
        });

    </script>
</body>
</html>
